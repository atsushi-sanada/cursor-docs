# Git コミット・プッシュ実行プロンプト

## 基本方針

- ユーザーからの指示に基づいて、**変更内容を適切にコミットしてプッシュ**する
- **指定が無ければ全ての差分と追加を反映**する
- コミットメッセージは既存の`CreateCommitComment.md`のルールに従って作成する

## 実行ルール

### コミット対象の決定

- **ユーザー指定がある場合**: 指定されたファイル・ディレクトリのみをコミット対象とする
- **ユーザー指定が無い場合**: `git status`で確認した全ての変更（新規追加・変更・削除）をコミット対象とする
- コミット前に必ず`git status`で変更内容を確認する

### コミットメッセージ作成

- `CreateCommitComment.md`のルールに従ってコミットメッセージを作成する
- タイトルと本文を分けて、簡潔に箇条書きで記述する
- 変更内容を正確に反映したメッセージを作成する

### プッシュ実行

- コミット完了後、現在のブランチにプッシュする
- プッシュ前にリモートとの差分を確認する（必要に応じて`git pull`を実行）

## 実行手順

### 1. 変更内容確認フェーズ

1. `git status`を実行して、現在の変更状況を確認する
2. ユーザー指定がある場合は、指定されたファイル・ディレクトリの変更を確認する
3. ユーザー指定が無い場合は、全ての変更を確認する
4. **変更内容の詳細確認が必要な場合**:
   - `GIT_PAGER=cat git diff <ファイル名>` でページネーションを無効化して差分を確認
   - または `git diff --stat` で統計情報のみを確認
   - **注意**: `git diff` 単体はページネーションが起動し、タイムアウトの原因となるため使用しない

### 2. ステージングフェーズ

1. コミット対象のファイルを`git add`でステージングする
   - ユーザー指定がある場合: `git add <指定されたファイル・ディレクトリ>`
   - ユーザー指定が無い場合: `git add .` または `git add -A`
2. `git status`でステージング内容を確認する

### 3. コミットメッセージ作成フェーズ

1. ステージングされた変更内容を分析する
   - `GIT_PAGER=cat git diff --cached` でステージング済みの変更を確認（ページネーション無効化）
   - または `git diff --stat --cached` で統計情報のみを確認
2. `CreateCommitComment.md`のルールに従ってコミットメッセージを作成する
3. コミットメッセージの内容をユーザーに確認する（必要に応じて）

### 4. コミット実行フェーズ

1. `git commit -m "<コミットメッセージ>"`でコミットを実行する
2. コミットが正常に完了したことを確認する

### 5. プッシュ実行フェーズ

1. 現在のブランチ名を確認する（`git branch`または`git status`）
2. リモートとの差分を確認する（必要に応じて`git pull`を実行）
3. `git push origin <ブランチ名>`でプッシュを実行する
   - **注意**: リモート名が`origin`でない場合は、`git remote -v`で確認して適切なリモート名を使用する
4. プッシュが正常に完了したことを確認する

## エラーハンドリング

### コミット時のエラー

- コミットメッセージが空の場合: エラーメッセージを表示し、適切なメッセージを作成する
- ステージング対象が無い場合: エラーメッセージを表示し、変更内容を確認する

### プッシュ時のエラー

- リモートに新しいコミットがある場合: `git pull`を実行してマージまたはリベースする
- プッシュ権限がない場合: エラーメッセージを表示し、権限を確認する
- ブランチが存在しない場合: エラーメッセージを表示し、ブランチ名を確認する

### git diff 実行時のエラー

- ページネーションが起動してタイムアウトした場合: `GIT_PAGER=cat git diff`を使用する
- 出力が長すぎる場合: `git diff --stat`で統計情報のみを確認する
- **注意**: `git diff`コマンドでは`--no-pager`オプションは使用できないため、環境変数`GIT_PAGER=cat`を使用する

## 進捗報告ルール

### 各フェーズ完了時

- フェーズの完了を報告する
- 必要に応じて、実行結果の概要を簡潔に説明する

### エラー発生時

- エラーの内容を明確に報告する
- エラー解決のための手順を提示する
- エラー解決後、該当フェーズを再実行する

## 品質チェックリスト

- [ ] `git status`で変更内容を確認したか
- [ ] 変更内容の詳細確認時に`GIT_PAGER=cat git diff`を使用したか（ページネーション回避）
- [ ] コミット対象のファイルが適切にステージングされているか
- [ ] コミットメッセージが`CreateCommitComment.md`のルールに従っているか
- [ ] コミットが正常に完了したか
- [ ] 現在のブランチ名を確認したか
- [ ] リモート名を確認したか（`origin`以外の場合）
- [ ] リモートとの差分を確認したか（必要に応じて`git pull`を実行したか）
- [ ] プッシュが正常に完了したか
- [ ] エラーが発生した場合、適切にハンドリングしたか
